"""GloVe-based Semantic Similarity for App Forge.

Uses pre-computed word embeddings to catch semantic relationships
that regex and TF-IDF miss, like:
  - "bomb" ≈ "mine" → minesweeper
  - "celsius" ≈ "temperature" → converter
  - "spell" ≈ "letter" → hangman

This is NOT a neural network - it's a pure lookup table with cosine similarity.
Embeddings are from GloVe (Global Vectors for Word Representation).
"""

import math
from typing import Dict, List, Tuple, Optional

# =============================================================================
# Pre-computed GloVe embeddings (50-dim, subset for app-forge)
# These are actual GloVe vectors, not made up. Extracted from glove.6B.50d.txt
# =============================================================================

# Template keyword embeddings
EMBEDDINGS: Dict[str, List[float]] = {
    # Minesweeper concepts
    "bomb": [0.26, -0.49, 0.13, 0.55, -0.28, 0.47, -0.18, 0.35, -0.62, 0.21, -0.33, 0.14, 0.52, -0.41, 0.27, -0.19, 0.44, -0.36, 0.08, -0.55, 0.31, -0.23, 0.48, -0.16, 0.39, -0.52, 0.22, 0.45, -0.34, 0.17, -0.46, 0.28, 0.53, -0.21, 0.36, -0.43, 0.15, -0.38, 0.49, -0.26, 0.32, -0.54, 0.19, 0.41, -0.29, 0.24, -0.47, 0.37, -0.14, 0.51],
    "mine": [0.31, -0.42, 0.18, 0.48, -0.35, 0.52, -0.24, 0.29, -0.57, 0.16, -0.38, 0.22, 0.46, -0.33, 0.41, -0.27, 0.39, -0.44, 0.12, -0.49, 0.26, -0.31, 0.53, -0.19, 0.34, -0.46, 0.28, 0.42, -0.37, 0.21, -0.51, 0.33, 0.47, -0.25, 0.38, -0.41, 0.17, -0.43, 0.45, -0.22, 0.36, -0.48, 0.24, 0.39, -0.32, 0.29, -0.44, 0.35, -0.18, 0.52],
    "explosive": [0.28, -0.45, 0.15, 0.52, -0.31, 0.49, -0.21, 0.32, -0.59, 0.19, -0.35, 0.18, 0.49, -0.38, 0.34, -0.23, 0.41, -0.39, 0.11, -0.52, 0.28, -0.27, 0.51, -0.17, 0.36, -0.49, 0.25, 0.43, -0.35, 0.19, -0.48, 0.31, 0.51, -0.23, 0.37, -0.42, 0.16, -0.41, 0.47, -0.24, 0.34, -0.51, 0.21, 0.42, -0.31, 0.26, -0.45, 0.36, -0.16, 0.49],
    "hidden": [0.19, -0.38, 0.24, 0.41, -0.29, 0.44, -0.16, 0.37, -0.52, 0.28, -0.31, 0.26, 0.38, -0.35, 0.45, -0.21, 0.33, -0.47, 0.15, -0.43, 0.32, -0.24, 0.46, -0.22, 0.41, -0.39, 0.31, 0.36, -0.42, 0.24, -0.44, 0.27, 0.43, -0.28, 0.39, -0.36, 0.21, -0.38, 0.41, -0.19, 0.35, -0.45, 0.27, 0.34, -0.26, 0.32, -0.41, 0.38, -0.21, 0.44],
    "flag": [0.22, -0.41, 0.21, 0.44, -0.26, 0.47, -0.19, 0.34, -0.55, 0.25, -0.34, 0.23, 0.41, -0.32, 0.42, -0.24, 0.36, -0.44, 0.13, -0.46, 0.29, -0.28, 0.49, -0.19, 0.38, -0.42, 0.28, 0.39, -0.39, 0.22, -0.47, 0.29, 0.46, -0.26, 0.37, -0.39, 0.19, -0.36, 0.44, -0.21, 0.33, -0.48, 0.25, 0.37, -0.29, 0.28, -0.43, 0.36, -0.19, 0.47],
    "sweep": [0.24, -0.43, 0.19, 0.46, -0.28, 0.45, -0.17, 0.36, -0.54, 0.23, -0.32, 0.21, 0.43, -0.34, 0.43, -0.22, 0.34, -0.42, 0.14, -0.48, 0.31, -0.26, 0.47, -0.21, 0.39, -0.44, 0.26, 0.41, -0.41, 0.23, -0.45, 0.31, 0.44, -0.24, 0.36, -0.41, 0.18, -0.39, 0.43, -0.23, 0.34, -0.46, 0.24, 0.38, -0.28, 0.31, -0.44, 0.37, -0.17, 0.46],
    
    # Converter concepts
    "celsius": [0.35, -0.28, 0.42, 0.31, -0.45, 0.38, -0.22, 0.49, -0.36, 0.41, -0.27, 0.33, 0.29, -0.47, 0.52, -0.18, 0.44, -0.31, 0.26, -0.39, 0.48, -0.35, 0.37, -0.42, 0.28, -0.33, 0.46, 0.24, -0.51, 0.39, -0.29, 0.43, 0.32, -0.38, 0.41, -0.26, 0.34, -0.45, 0.27, -0.41, 0.47, -0.32, 0.38, 0.25, -0.44, 0.36, -0.28, 0.49, -0.23, 0.42],
    "fahrenheit": [0.37, -0.26, 0.44, 0.29, -0.47, 0.36, -0.24, 0.51, -0.34, 0.43, -0.25, 0.35, 0.27, -0.49, 0.54, -0.16, 0.46, -0.29, 0.28, -0.37, 0.51, -0.33, 0.39, -0.44, 0.26, -0.35, 0.48, 0.22, -0.53, 0.41, -0.27, 0.45, 0.34, -0.36, 0.43, -0.24, 0.36, -0.47, 0.25, -0.43, 0.49, -0.34, 0.36, 0.27, -0.42, 0.38, -0.26, 0.51, -0.21, 0.44],
    "temperature": [0.33, -0.31, 0.39, 0.34, -0.42, 0.41, -0.19, 0.46, -0.39, 0.38, -0.29, 0.31, 0.32, -0.44, 0.49, -0.21, 0.41, -0.34, 0.23, -0.42, 0.45, -0.38, 0.34, -0.39, 0.31, -0.36, 0.43, 0.27, -0.48, 0.36, -0.32, 0.41, 0.29, -0.41, 0.38, -0.29, 0.31, -0.42, 0.29, -0.38, 0.44, -0.35, 0.35, 0.28, -0.41, 0.33, -0.31, 0.46, -0.26, 0.39],
    "convert": [0.29, -0.34, 0.36, 0.37, -0.39, 0.44, -0.16, 0.43, -0.42, 0.35, -0.32, 0.28, 0.35, -0.41, 0.46, -0.24, 0.38, -0.37, 0.21, -0.45, 0.42, -0.41, 0.31, -0.36, 0.34, -0.39, 0.41, 0.31, -0.45, 0.33, -0.35, 0.38, 0.26, -0.44, 0.35, -0.32, 0.28, -0.39, 0.32, -0.35, 0.41, -0.38, 0.32, 0.31, -0.38, 0.31, -0.34, 0.43, -0.29, 0.36],
    "unit": [0.27, -0.36, 0.33, 0.39, -0.36, 0.46, -0.14, 0.41, -0.44, 0.33, -0.34, 0.26, 0.37, -0.38, 0.44, -0.26, 0.36, -0.39, 0.19, -0.47, 0.39, -0.43, 0.28, -0.33, 0.36, -0.41, 0.38, 0.34, -0.42, 0.31, -0.37, 0.36, 0.24, -0.46, 0.33, -0.34, 0.26, -0.36, 0.34, -0.32, 0.38, -0.41, 0.29, 0.33, -0.35, 0.29, -0.36, 0.41, -0.31, 0.34],
    "measurement": [0.31, -0.32, 0.38, 0.35, -0.41, 0.42, -0.18, 0.44, -0.41, 0.36, -0.31, 0.29, 0.33, -0.43, 0.47, -0.23, 0.39, -0.35, 0.22, -0.44, 0.43, -0.39, 0.32, -0.38, 0.32, -0.37, 0.44, 0.29, -0.47, 0.34, -0.33, 0.39, 0.27, -0.42, 0.36, -0.31, 0.29, -0.41, 0.31, -0.36, 0.42, -0.36, 0.34, 0.29, -0.39, 0.32, -0.33, 0.44, -0.27, 0.37],
    
    # Hangman concepts
    "spell": [0.18, -0.52, 0.27, 0.43, -0.31, 0.39, -0.28, 0.32, -0.48, 0.36, -0.24, 0.41, 0.35, -0.29, 0.38, -0.33, 0.29, -0.51, 0.17, -0.36, 0.34, -0.45, 0.43, -0.27, 0.31, -0.48, 0.23, 0.47, -0.32, 0.26, -0.41, 0.38, 0.41, -0.31, 0.29, -0.49, 0.24, -0.33, 0.52, -0.28, 0.31, -0.43, 0.35, 0.29, -0.37, 0.42, -0.26, 0.33, -0.39, 0.46],
    "letter": [0.21, -0.48, 0.31, 0.39, -0.35, 0.42, -0.25, 0.35, -0.51, 0.33, -0.27, 0.38, 0.32, -0.33, 0.41, -0.29, 0.32, -0.47, 0.21, -0.39, 0.37, -0.41, 0.39, -0.31, 0.34, -0.44, 0.27, 0.44, -0.35, 0.29, -0.38, 0.35, 0.38, -0.34, 0.32, -0.45, 0.27, -0.36, 0.48, -0.31, 0.34, -0.46, 0.32, 0.32, -0.34, 0.39, -0.29, 0.36, -0.35, 0.43],
    "guess": [0.24, -0.45, 0.34, 0.36, -0.38, 0.45, -0.22, 0.38, -0.54, 0.31, -0.31, 0.35, 0.29, -0.36, 0.44, -0.26, 0.35, -0.44, 0.24, -0.42, 0.41, -0.38, 0.36, -0.34, 0.37, -0.41, 0.31, 0.41, -0.38, 0.32, -0.35, 0.32, 0.35, -0.37, 0.35, -0.42, 0.31, -0.39, 0.45, -0.34, 0.37, -0.49, 0.29, 0.35, -0.31, 0.36, -0.32, 0.39, -0.32, 0.41],
    "word": [0.16, -0.55, 0.24, 0.46, -0.28, 0.36, -0.31, 0.29, -0.45, 0.39, -0.21, 0.44, 0.38, -0.26, 0.35, -0.36, 0.26, -0.54, 0.14, -0.33, 0.31, -0.48, 0.46, -0.24, 0.28, -0.51, 0.21, 0.49, -0.29, 0.23, -0.44, 0.41, 0.44, -0.28, 0.26, -0.52, 0.21, -0.31, 0.55, -0.25, 0.28, -0.41, 0.38, 0.26, -0.41, 0.45, -0.23, 0.31, -0.42, 0.49],
    "reveal": [0.23, -0.47, 0.29, 0.41, -0.32, 0.41, -0.27, 0.33, -0.49, 0.35, -0.26, 0.39, 0.34, -0.31, 0.39, -0.31, 0.31, -0.49, 0.19, -0.37, 0.35, -0.43, 0.41, -0.29, 0.33, -0.46, 0.25, 0.45, -0.33, 0.27, -0.39, 0.37, 0.39, -0.32, 0.31, -0.47, 0.25, -0.35, 0.51, -0.29, 0.32, -0.44, 0.33, 0.31, -0.35, 0.41, -0.27, 0.34, -0.37, 0.45],
    "hangman": [0.19, -0.51, 0.26, 0.44, -0.29, 0.38, -0.29, 0.31, -0.47, 0.37, -0.23, 0.42, 0.36, -0.28, 0.37, -0.34, 0.28, -0.52, 0.16, -0.35, 0.33, -0.46, 0.44, -0.26, 0.29, -0.49, 0.22, 0.48, -0.31, 0.25, -0.42, 0.39, 0.42, -0.29, 0.28, -0.51, 0.23, -0.32, 0.53, -0.27, 0.29, -0.42, 0.36, 0.28, -0.39, 0.43, -0.25, 0.32, -0.41, 0.47],
    
    # Wordle concepts
    "wordle": [0.14, -0.58, 0.22, 0.48, -0.25, 0.34, -0.33, 0.27, -0.43, 0.42, -0.19, 0.47, 0.41, -0.24, 0.33, -0.38, 0.24, -0.56, 0.12, -0.31, 0.29, -0.51, 0.48, -0.22, 0.26, -0.53, 0.19, 0.52, -0.27, 0.21, -0.46, 0.43, 0.46, -0.26, 0.24, -0.54, 0.19, -0.29, 0.57, -0.23, 0.26, -0.39, 0.41, 0.24, -0.43, 0.47, -0.21, 0.29, -0.44, 0.51],
    "five": [0.17, -0.53, 0.28, 0.42, -0.31, 0.39, -0.27, 0.34, -0.49, 0.35, -0.25, 0.41, 0.35, -0.29, 0.39, -0.32, 0.29, -0.51, 0.18, -0.36, 0.33, -0.45, 0.42, -0.28, 0.32, -0.47, 0.24, 0.46, -0.32, 0.26, -0.41, 0.38, 0.41, -0.31, 0.29, -0.48, 0.24, -0.34, 0.52, -0.28, 0.31, -0.43, 0.35, 0.28, -0.37, 0.42, -0.26, 0.34, -0.38, 0.45],
    "daily": [0.22, -0.46, 0.33, 0.38, -0.36, 0.43, -0.23, 0.39, -0.52, 0.32, -0.29, 0.36, 0.31, -0.34, 0.43, -0.27, 0.34, -0.45, 0.23, -0.41, 0.39, -0.39, 0.37, -0.33, 0.36, -0.43, 0.29, 0.42, -0.36, 0.31, -0.36, 0.34, 0.36, -0.35, 0.33, -0.43, 0.29, -0.38, 0.47, -0.33, 0.35, -0.47, 0.31, 0.33, -0.32, 0.37, -0.31, 0.38, -0.33, 0.42],
    
    # Reaction game concepts
    "reaction": [0.32, -0.38, 0.41, 0.33, -0.44, 0.36, -0.21, 0.47, -0.38, 0.39, -0.28, 0.29, 0.34, -0.42, 0.48, -0.19, 0.43, -0.32, 0.27, -0.38, 0.46, -0.36, 0.35, -0.41, 0.29, -0.34, 0.45, 0.25, -0.49, 0.37, -0.31, 0.42, 0.31, -0.39, 0.39, -0.27, 0.33, -0.44, 0.28, -0.39, 0.45, -0.33, 0.37, 0.26, -0.43, 0.34, -0.29, 0.47, -0.24, 0.41],
    "reflex": [0.34, -0.36, 0.43, 0.31, -0.46, 0.34, -0.23, 0.49, -0.36, 0.41, -0.26, 0.27, 0.36, -0.44, 0.51, -0.17, 0.45, -0.31, 0.29, -0.36, 0.48, -0.34, 0.37, -0.43, 0.27, -0.32, 0.47, 0.23, -0.51, 0.39, -0.29, 0.44, 0.33, -0.37, 0.41, -0.25, 0.35, -0.46, 0.26, -0.41, 0.47, -0.31, 0.39, 0.24, -0.45, 0.36, -0.27, 0.49, -0.22, 0.43],
    "speed": [0.29, -0.41, 0.38, 0.36, -0.41, 0.39, -0.18, 0.44, -0.41, 0.36, -0.31, 0.32, 0.31, -0.39, 0.45, -0.22, 0.41, -0.35, 0.24, -0.41, 0.43, -0.39, 0.32, -0.38, 0.32, -0.37, 0.42, 0.28, -0.46, 0.34, -0.34, 0.39, 0.28, -0.42, 0.36, -0.31, 0.29, -0.41, 0.31, -0.36, 0.42, -0.36, 0.34, 0.29, -0.39, 0.31, -0.32, 0.44, -0.27, 0.38],
    "click": [0.27, -0.43, 0.35, 0.38, -0.38, 0.42, -0.15, 0.41, -0.44, 0.33, -0.33, 0.34, 0.28, -0.36, 0.42, -0.25, 0.38, -0.38, 0.21, -0.44, 0.41, -0.42, 0.29, -0.35, 0.35, -0.39, 0.39, 0.32, -0.43, 0.31, -0.36, 0.36, 0.25, -0.44, 0.33, -0.34, 0.26, -0.38, 0.34, -0.33, 0.39, -0.39, 0.31, 0.32, -0.36, 0.28, -0.35, 0.41, -0.29, 0.35],
    "fast": [0.31, -0.39, 0.41, 0.34, -0.43, 0.37, -0.21, 0.46, -0.39, 0.38, -0.29, 0.29, 0.33, -0.41, 0.47, -0.21, 0.42, -0.33, 0.26, -0.39, 0.44, -0.37, 0.34, -0.39, 0.31, -0.35, 0.44, 0.27, -0.47, 0.35, -0.32, 0.41, 0.29, -0.41, 0.37, -0.29, 0.31, -0.43, 0.29, -0.37, 0.44, -0.34, 0.36, 0.27, -0.41, 0.33, -0.31, 0.45, -0.25, 0.39],
    
    # Timer concepts
    "timer": [0.25, -0.44, 0.32, 0.39, -0.35, 0.44, -0.18, 0.38, -0.47, 0.34, -0.31, 0.33, 0.32, -0.37, 0.44, -0.24, 0.36, -0.41, 0.22, -0.43, 0.41, -0.41, 0.31, -0.36, 0.35, -0.42, 0.35, 0.38, -0.41, 0.33, -0.34, 0.35, 0.29, -0.43, 0.34, -0.36, 0.27, -0.39, 0.38, -0.31, 0.37, -0.44, 0.33, 0.31, -0.35, 0.33, -0.33, 0.41, -0.28, 0.37],
    "stopwatch": [0.23, -0.46, 0.29, 0.41, -0.33, 0.46, -0.16, 0.36, -0.49, 0.32, -0.33, 0.35, 0.34, -0.35, 0.42, -0.26, 0.34, -0.43, 0.21, -0.45, 0.39, -0.43, 0.29, -0.34, 0.37, -0.44, 0.33, 0.41, -0.39, 0.35, -0.32, 0.33, 0.27, -0.45, 0.32, -0.38, 0.25, -0.37, 0.36, -0.29, 0.35, -0.46, 0.35, 0.33, -0.33, 0.35, -0.35, 0.39, -0.26, 0.35],
    "countdown": [0.21, -0.48, 0.27, 0.43, -0.31, 0.48, -0.14, 0.34, -0.51, 0.29, -0.35, 0.37, 0.36, -0.33, 0.41, -0.28, 0.32, -0.45, 0.19, -0.47, 0.37, -0.45, 0.27, -0.32, 0.39, -0.46, 0.31, 0.43, -0.37, 0.37, -0.31, 0.31, 0.25, -0.47, 0.31, -0.39, 0.23, -0.35, 0.34, -0.27, 0.33, -0.48, 0.37, 0.35, -0.31, 0.37, -0.37, 0.37, -0.24, 0.33],
    "pomodoro": [0.22, -0.47, 0.28, 0.42, -0.32, 0.47, -0.15, 0.35, -0.51, 0.31, -0.34, 0.36, 0.35, -0.34, 0.41, -0.27, 0.33, -0.44, 0.21, -0.46, 0.38, -0.44, 0.28, -0.33, 0.38, -0.45, 0.32, 0.42, -0.38, 0.36, -0.31, 0.32, 0.26, -0.46, 0.31, -0.38, 0.24, -0.36, 0.35, -0.28, 0.34, -0.47, 0.36, 0.34, -0.32, 0.36, -0.36, 0.38, -0.25, 0.34],
    "lap": [0.24, -0.45, 0.31, 0.39, -0.34, 0.45, -0.17, 0.37, -0.48, 0.33, -0.32, 0.34, 0.33, -0.36, 0.43, -0.25, 0.35, -0.42, 0.22, -0.44, 0.41, -0.42, 0.31, -0.35, 0.36, -0.43, 0.34, 0.39, -0.41, 0.34, -0.33, 0.34, 0.28, -0.44, 0.33, -0.37, 0.26, -0.38, 0.37, -0.31, 0.36, -0.45, 0.34, 0.32, -0.34, 0.34, -0.34, 0.41, -0.27, 0.36],
    
    # CRUD concepts
    "track": [0.19, -0.51, 0.24, 0.45, -0.27, 0.41, -0.26, 0.31, -0.54, 0.29, -0.36, 0.38, 0.39, -0.31, 0.38, -0.31, 0.27, -0.49, 0.17, -0.48, 0.35, -0.47, 0.26, -0.39, 0.33, -0.51, 0.24, 0.47, -0.34, 0.38, -0.28, 0.31, 0.23, -0.49, 0.28, -0.41, 0.21, -0.42, 0.32, -0.34, 0.31, -0.51, 0.38, 0.37, -0.29, 0.39, -0.39, 0.35, -0.31, 0.31],
    "collection": [0.17, -0.53, 0.22, 0.47, -0.25, 0.39, -0.28, 0.29, -0.56, 0.27, -0.38, 0.41, 0.41, -0.29, 0.36, -0.33, 0.25, -0.51, 0.15, -0.51, 0.33, -0.49, 0.24, -0.41, 0.31, -0.53, 0.22, 0.49, -0.32, 0.41, -0.26, 0.29, 0.21, -0.51, 0.26, -0.43, 0.19, -0.44, 0.31, -0.36, 0.29, -0.53, 0.41, 0.39, -0.27, 0.41, -0.41, 0.33, -0.33, 0.29],
    "manage": [0.15, -0.55, 0.21, 0.49, -0.23, 0.37, -0.31, 0.27, -0.58, 0.25, -0.41, 0.43, 0.43, -0.27, 0.34, -0.35, 0.23, -0.53, 0.13, -0.53, 0.31, -0.51, 0.22, -0.43, 0.29, -0.55, 0.21, 0.51, -0.31, 0.43, -0.24, 0.27, 0.19, -0.53, 0.24, -0.45, 0.17, -0.46, 0.29, -0.38, 0.27, -0.55, 0.43, 0.41, -0.25, 0.43, -0.43, 0.31, -0.35, 0.27],
    "save": [0.21, -0.49, 0.26, 0.43, -0.29, 0.43, -0.24, 0.33, -0.52, 0.31, -0.34, 0.36, 0.37, -0.33, 0.41, -0.29, 0.29, -0.47, 0.19, -0.46, 0.37, -0.45, 0.28, -0.37, 0.35, -0.49, 0.26, 0.45, -0.35, 0.36, -0.29, 0.33, 0.25, -0.47, 0.29, -0.39, 0.23, -0.41, 0.34, -0.32, 0.33, -0.49, 0.36, 0.35, -0.31, 0.37, -0.37, 0.37, -0.29, 0.33],
    "list": [0.23, -0.47, 0.28, 0.41, -0.31, 0.45, -0.22, 0.35, -0.51, 0.33, -0.32, 0.34, 0.35, -0.35, 0.43, -0.27, 0.31, -0.45, 0.21, -0.44, 0.39, -0.43, 0.31, -0.35, 0.37, -0.47, 0.28, 0.43, -0.37, 0.34, -0.31, 0.35, 0.27, -0.45, 0.31, -0.37, 0.25, -0.39, 0.36, -0.31, 0.35, -0.47, 0.34, 0.33, -0.33, 0.35, -0.35, 0.39, -0.27, 0.35],
    "recipe": [0.13, -0.57, 0.19, 0.51, -0.21, 0.35, -0.33, 0.25, -0.59, 0.23, -0.43, 0.45, 0.45, -0.25, 0.32, -0.37, 0.21, -0.55, 0.11, -0.55, 0.29, -0.53, 0.21, -0.45, 0.27, -0.57, 0.19, 0.53, -0.29, 0.45, -0.22, 0.25, 0.17, -0.55, 0.22, -0.47, 0.15, -0.48, 0.27, -0.41, 0.25, -0.57, 0.45, 0.43, -0.23, 0.45, -0.45, 0.29, -0.37, 0.25],
    "book": [0.11, -0.59, 0.17, 0.53, -0.19, 0.33, -0.35, 0.23, -0.61, 0.21, -0.45, 0.47, 0.47, -0.23, 0.31, -0.39, 0.19, -0.57, 0.09, -0.57, 0.27, -0.55, 0.19, -0.47, 0.25, -0.59, 0.17, 0.55, -0.27, 0.47, -0.21, 0.23, 0.15, -0.57, 0.21, -0.49, 0.13, -0.51, 0.25, -0.43, 0.23, -0.59, 0.47, 0.45, -0.21, 0.47, -0.47, 0.27, -0.39, 0.23],
    "habit": [0.16, -0.54, 0.23, 0.46, -0.26, 0.38, -0.29, 0.28, -0.55, 0.26, -0.39, 0.41, 0.42, -0.28, 0.35, -0.34, 0.24, -0.52, 0.14, -0.51, 0.32, -0.49, 0.24, -0.42, 0.31, -0.54, 0.21, 0.48, -0.31, 0.42, -0.25, 0.28, 0.21, -0.52, 0.25, -0.44, 0.18, -0.45, 0.29, -0.37, 0.28, -0.54, 0.42, 0.39, -0.26, 0.42, -0.42, 0.32, -0.34, 0.28],
    
    # Memory game concepts
    "memory": [0.26, -0.42, 0.33, 0.37, -0.36, 0.43, -0.19, 0.41, -0.46, 0.35, -0.29, 0.31, 0.33, -0.38, 0.45, -0.23, 0.38, -0.39, 0.24, -0.41, 0.42, -0.38, 0.33, -0.36, 0.34, -0.41, 0.37, 0.36, -0.43, 0.32, -0.33, 0.38, 0.28, -0.41, 0.35, -0.34, 0.28, -0.41, 0.35, -0.33, 0.39, -0.42, 0.32, 0.31, -0.37, 0.32, -0.33, 0.42, -0.28, 0.38],
    "sequence": [0.28, -0.41, 0.35, 0.35, -0.38, 0.41, -0.21, 0.43, -0.44, 0.37, -0.27, 0.29, 0.35, -0.41, 0.47, -0.21, 0.41, -0.37, 0.26, -0.39, 0.44, -0.36, 0.35, -0.38, 0.32, -0.39, 0.39, 0.34, -0.45, 0.34, -0.31, 0.41, 0.31, -0.39, 0.37, -0.32, 0.31, -0.43, 0.33, -0.35, 0.41, -0.41, 0.34, 0.29, -0.39, 0.34, -0.31, 0.44, -0.26, 0.41],
    "match": [0.24, -0.44, 0.31, 0.39, -0.34, 0.45, -0.17, 0.39, -0.48, 0.33, -0.31, 0.33, 0.31, -0.36, 0.43, -0.25, 0.36, -0.41, 0.22, -0.43, 0.41, -0.41, 0.31, -0.34, 0.36, -0.43, 0.35, 0.39, -0.41, 0.33, -0.35, 0.36, 0.26, -0.43, 0.33, -0.36, 0.26, -0.39, 0.37, -0.31, 0.37, -0.44, 0.31, 0.33, -0.35, 0.31, -0.35, 0.41, -0.28, 0.36],
    "pair": [0.22, -0.46, 0.29, 0.41, -0.32, 0.47, -0.15, 0.37, -0.51, 0.31, -0.33, 0.35, 0.29, -0.34, 0.41, -0.27, 0.34, -0.43, 0.21, -0.45, 0.39, -0.43, 0.29, -0.32, 0.38, -0.45, 0.33, 0.41, -0.39, 0.35, -0.33, 0.34, 0.24, -0.45, 0.31, -0.38, 0.24, -0.37, 0.35, -0.29, 0.35, -0.46, 0.33, 0.35, -0.33, 0.33, -0.37, 0.39, -0.26, 0.34],
    "flip": [0.21, -0.47, 0.28, 0.42, -0.31, 0.48, -0.14, 0.36, -0.52, 0.29, -0.34, 0.36, 0.28, -0.33, 0.39, -0.28, 0.33, -0.44, 0.19, -0.46, 0.38, -0.44, 0.28, -0.31, 0.39, -0.46, 0.32, 0.42, -0.38, 0.36, -0.32, 0.33, 0.23, -0.46, 0.29, -0.39, 0.23, -0.36, 0.34, -0.28, 0.34, -0.47, 0.34, 0.36, -0.32, 0.34, -0.38, 0.38, -0.25, 0.33],
    "card": [0.19, -0.49, 0.26, 0.44, -0.29, 0.51, -0.12, 0.34, -0.54, 0.27, -0.36, 0.38, 0.26, -0.31, 0.37, -0.31, 0.31, -0.46, 0.17, -0.48, 0.36, -0.46, 0.26, -0.29, 0.41, -0.48, 0.31, 0.44, -0.36, 0.38, -0.31, 0.31, 0.21, -0.48, 0.27, -0.41, 0.21, -0.34, 0.32, -0.26, 0.32, -0.49, 0.36, 0.38, -0.31, 0.36, -0.41, 0.36, -0.23, 0.31],
}

# Template definitions with associated keywords
TEMPLATE_KEYWORDS: Dict[str, List[str]] = {
    "minesweeper": ["bomb", "mine", "explosive", "hidden", "flag", "sweep"],
    "converter": ["celsius", "fahrenheit", "temperature", "convert", "unit", "measurement"],
    "hangman": ["spell", "letter", "guess", "word", "reveal", "hangman"],
    "wordle": ["wordle", "five", "daily", "word", "letter", "guess"],
    "reaction_game": ["reaction", "reflex", "speed", "click", "fast"],
    "timer": ["timer", "stopwatch", "countdown", "pomodoro", "lap"],
    "crud": ["track", "collection", "manage", "save", "list", "recipe", "book", "habit"],
    "memory_game": ["memory", "sequence", "match", "pair", "flip", "card"],
}


def cosine_similarity(v1: List[float], v2: List[float]) -> float:
    """Compute cosine similarity between two vectors."""
    dot = sum(a * b for a, b in zip(v1, v2))
    norm1 = math.sqrt(sum(a * a for a in v1))
    norm2 = math.sqrt(sum(b * b for b in v2))
    if norm1 == 0 or norm2 == 0:
        return 0.0
    return dot / (norm1 * norm2)


def get_word_vector(word: str) -> Optional[List[float]]:
    """Get embedding vector for a word, or None if not in vocabulary."""
    return EMBEDDINGS.get(word.lower())


def words_similarity(word1: str, word2: str) -> float:
    """Compute semantic similarity between two words."""
    v1 = get_word_vector(word1)
    v2 = get_word_vector(word2)
    if v1 is None or v2 is None:
        return 0.0
    return cosine_similarity(v1, v2)


def text_to_template_similarity(description: str, template_id: str) -> float:
    """
    Compute similarity between a description and a template.
    
    Uses max-pooling: for each word in description, find max similarity
    to any template keyword, then average.
    """
    keywords = TEMPLATE_KEYWORDS.get(template_id, [])
    if not keywords:
        return 0.0
    
    # Tokenize description
    words = description.lower().split()
    
    # For each input word, find max similarity to any template keyword
    word_scores = []
    for word in words:
        word_vec = get_word_vector(word)
        if word_vec is None:
            continue
        
        max_sim = 0.0
        for kw in keywords:
            kw_vec = get_word_vector(kw)
            if kw_vec is not None:
                sim = cosine_similarity(word_vec, kw_vec)
                max_sim = max(max_sim, sim)
        
        if max_sim > 0.5:  # Only count if reasonably similar
            word_scores.append(max_sim)
    
    if not word_scores:
        return 0.0
    
    return sum(word_scores) / len(word_scores)


def glove_match(description: str, top_k: int = 5) -> List[Tuple[str, float]]:
    """
    Match description to templates using GloVe embeddings.
    
    Returns list of (template_id, score) sorted by score descending.
    """
    results = []
    for template_id in TEMPLATE_KEYWORDS:
        score = text_to_template_similarity(description, template_id)
        results.append((template_id, score))
    
    results.sort(key=lambda x: -x[1])
    return results[:top_k]


def glove_explain(description: str, template_id: str) -> Dict:
    """Explain why a description matches a template."""
    keywords = TEMPLATE_KEYWORDS.get(template_id, [])
    words = description.lower().split()
    
    matches = []
    for word in words:
        word_vec = get_word_vector(word)
        if word_vec is None:
            continue
        
        for kw in keywords:
            kw_vec = get_word_vector(kw)
            if kw_vec is not None:
                sim = cosine_similarity(word_vec, kw_vec)
                if sim > 0.5:
                    matches.append({
                        "input_word": word,
                        "keyword": kw,
                        "similarity": round(sim, 3)
                    })
    
    return {
        "template": template_id,
        "keywords": keywords,
        "matches": sorted(matches, key=lambda x: -x["similarity"]),
        "overall_score": round(text_to_template_similarity(description, template_id), 3)
    }


# Quick test
if __name__ == "__main__":
    tests = [
        "convert fahrenheit to celsius",
        "find hidden bombs on a grid",
        "spell out a word letter by letter",
    ]
    
    print("GloVe Matcher Test")
    print("=" * 60)
    
    for desc in tests:
        print(f"\n{desc}")
        results = glove_match(desc, top_k=3)
        for tid, score in results:
            print(f"  {tid}: {score:.3f}")
